.\" last modified 2015-06-09
.\" Dorai Sitaram
.
.\" don't load if not groff
.
.if !\n(.g .nx
.
.\" don't load more than once
.
.if d eval4troff:snippets .nx
.
.if !\n[.troff2page] \{\
.de eval4troff:snippets
.  sy touch \\*[eval4troff:file]
.  sy nodejs \\*[eval4troff:file]
..
.\}
.
.if '\*[AUXF]'' .ds AUXF .trofftemp
.
.nr eval4troff:already_setup 0
.
.de eval4troff:setup
.  if \\n[eval4troff:already_setup] .return
.  nr eval4troff:already_setup 1
.  nr eval4troff:count 0
.  if !\\n[.U] .return
.  ds eval4troff:file \\*[AUXF].js
.  eval4troff:snippets
.  open eval4troff:port \\*[eval4troff:file]
.  write eval4troff:port var troff;
.  write eval4troff:port var eval4troff_fs = require('fs');
.  write eval4troff:port function eval4troff_preamble(f) {
.  write eval4troff:port   troff = eval4troff_fs.createWriteStream(f);
.  write eval4troff:port }
.  write eval4troff:port function eval4troff_postamble() {
.  write eval4troff:port   troff.write('\\\\\\\\c\\\\n')
.  write eval4troff:port   troff.write('.ds eval4troff:status done\\\\n')
.  write eval4troff:port   troff.end();
.  write eval4troff:port }
..
.
.ds eval4troff:status try
.
.de eval
.  eo
.  de eval4troff:text endeval
..
.
.de endeval
.  ec
.  eval4troff:so_snippet
.  eval4troff:write_snippet
..
.
.de eval4troff:write_snippet
.  if !\\n[.U] .return
.  write eval4troff:port eval4troff_preamble('\\*[eval4troff:snippet_file]')
.  writem eval4troff:port eval4troff:text
.  write eval4troff:port eval4troff_postamble()
..
.
.de eval4troff:so_snippet
.  eval4troff:setup
.  nr eval4troff:count +1
.  ds eval4troff:snippet_file \\*[AUXF]_eval_\\n[eval4troff:count].tmp
.  if !'\\*[eval4troff:status]'rerun' \{\
.    nr eval4troff:systat 0
.    if \\n[.U] \{\
.      sy test -f \\*[eval4troff:snippet_file]
.      nr eval4troff:systat \\n[systat]
.    \}
.    if !\\n[eval4troff:systat] \{\
.      so \\*[eval4troff:snippet_file]
.      if '\\*[eval4troff:status]'done' .return
.    \}
.    ds eval4troff:status rerun
.    if !\\n[.troff2page] .tm Rerun groff with -U
.  \}
\[rh]eval\[lh]
..
.
.ig ##
.\" define eval4troff:snippets for troff2page.js
.##
